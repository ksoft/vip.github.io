/*
Navicat MySQL Data Transfer

Source Server         : 晶链通&国药-uat
Source Server Version : 50634
Source Host           : rm-uf6h5m5e6j59v169bo.mysql.rds.aliyuncs.com:3306
Source Database       : uat_jlt_pms

Target Server Type    : MYSQL
Target Server Version : 50634
File Encoding         : 65001

Date: 2018-12-13 11:15:39
*/

SET FOREIGN_KEY_CHECKS=0;

-- ----------------------------
-- Table structure for jlt_job_detail
-- ----------------------------
DROP TABLE IF EXISTS `jlt_job_detail`;
CREATE TABLE `jlt_job_detail` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键',
  `tenant_id` bigint(20) NOT NULL COMMENT '租户id',
  `department_id` bigint(20) DEFAULT NULL COMMENT '部门主键',
  `job_id` bigint(20) NOT NULL COMMENT '任务名称',
  `job_type` varchar(1) NOT NULL DEFAULT 'R' COMMENT '任务类型：R：读，W：写',
  `data_read_source` varchar(255) DEFAULT 'DB' COMMENT '数据来源：数据库：DB，Redis：REDIS',
  `schema_name` varchar(255) DEFAULT NULL COMMENT '库名(sass/upm/pms)',
  `table_name` varchar(50) DEFAULT NULL COMMENT '表名称',
  `redis_key` varchar(255) DEFAULT NULL COMMENT '当data_read_source为REDIS时，取数据的Redis Key',
  `is_exclude_time` char(1) DEFAULT 'N' COMMENT '抽取时，是否忽略时间字段，Y:是；N：否，不根据创建时间和修改时间抽取',
  `is_exclude_tenant_id` char(1) DEFAULT 'N' COMMENT '抽取时，是否忽略tenant_id，比如字典表等；Y:是，N:否',
  `tenant_id_condition` longtext COMMENT '需要过虑的tenant_id数据条件，以and开头',
  `no_update_columns` varchar(100) DEFAULT NULL COMMENT '插入或更新时，不更新的字段',
  `no_insert_columns` varchar(4000) DEFAULT NULL COMMENT '忽略的字段，不做插入和更新',
  `customer_sql` varchar(4000) DEFAULT NULL COMMENT 'table_name的子查询SQL',
  `last_exec_success_time` datetime DEFAULT NULL COMMENT '上一次成功执行的时间，如果失败，不更新此字段',
  `last_exec_result` char(1) DEFAULT NULL COMMENT '上一次执行结果，Y:成功，N：失败',
  `msg` longtext COMMENT '成功或失败消息',
  `extend_where_condition` longtext COMMENT '扩展的where条件，以and开头',
  `order_id` int(11) DEFAULT NULL COMMENT '写入时若需要删除数据，可能涉及删除时的先后关系，按序号从小到大删除',
  `rec_ver` int(8) DEFAULT NULL COMMENT '版本号',
  `rec_status` int(1) DEFAULT NULL COMMENT '逻辑删除：0-正常，1-删除',
  `creator` varchar(32) DEFAULT NULL COMMENT '创建人',
  `create_name` varchar(32) DEFAULT NULL COMMENT '创建人名称',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `modifier` varchar(32) DEFAULT NULL COMMENT '修改人',
  `modify_name` varchar(32) DEFAULT NULL COMMENT '修改人名称',
  `modify_time` datetime NOT NULL DEFAULT '0000-00-00 00:00:00' COMMENT '修改时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `unq_1` (`schema_name`,`table_name`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=15 DEFAULT CHARSET=utf8 ROW_FORMAT=COMPACT COMMENT='晶链通数据同步作业';

-- ----------------------------
-- Records of jlt_job_detail
-- ----------------------------
INSERT INTO `jlt_job_detail` VALUES ('1', '1052596984302551041', null, '1', 'R', 'DB', 'saas', 'et_waybill_event_info', null, 'N', 'N', 'select carrier_id from cd_carrier_config where bind_type=2 and tenant_id =  tenant_id_replace', '', '', 'SELECT\r\n			a.*\r\n		FROM\r\n			et_waybill_event_info a\r\n			inner join et_waybill_info b on a.waybill_no=b.waybill_no\r\n		where b.consigner_id = tenant_id_replace', '2018-11-08 17:13:02', 'Y', null, null, null, '0', '0', 'admin', 'sys', '2018-09-11 16:52:09', '', '', '2018-09-10 20:23:04');
INSERT INTO `jlt_job_detail` VALUES ('2', '1052596984302551041', null, '1', 'R', 'DB', 'saas', 'et_waybill_exception', null, 'N', 'N', 'select carrier_id from cd_carrier_config where bind_type=2 and tenant_id =  tenant_id_replace\r\nunion all\r\nselect  tenant_id_replace', '', null, 'SELECT\r\na.exception_no,\r\na.waybill_no,\r\na.ex_waybill_no,\r\nif(a.waybill_status<=30,30,a.waybill_status) waybill_status,\r\na.exception_type,\r\na.exception_type_name,\r\na.exception_sub_type,\r\na.exception_sub_type_name,\r\na.exception_content,\r\na.exception_time,\r\na.exception_address,\r\na.longitude,\r\na.latitude,\r\na.exception_number,\r\na.exception_quantity,\r\na.exception_reason,\r\na.exception_remark,\r\na.exception_file_num,\r\na.register_person,\r\na.register_time,\r\na.source_channel,\r\na.responsible_party,\r\na.contact_tel,\r\na.expect_return_time,\r\na.rec_ver,\r\na.rec_status,\r\na.creator,\r\na.create_name,\r\na.create_time,\r\na.modifier,\r\na.modify_name,\r\na.modify_time,\r\na.tenant_id,\r\na.department_id,\r\na.handle_flag\r\nFROM\r\n	et_waybill_exception a\r\nINNER JOIN et_waybill_info c on a.waybill_no = c.waybill_no\r\nWHERE a.exception_type_name<>\'温度超标\'\r\nand c.consigner_id = tenant_id_replace\r\nUNION ALL\r\nselect\r\nCONCAT(\'WDEX\',a.alert_no) exception_no,\r\nc.waybill_no,\r\nc.ex_waybill_no,\r\nif(c.waybill_status<=30,30,c.waybill_status) waybill_status,\r\n\'TEMPERATURE_EXCEEDED_ALARM\' exception_type,\r\nif(a.alert_type=10,\'温度预警\',\'温度超标\') exception_type_name,\r\nnull exception_sub_type,\r\nnull exception_sub_type_name,\r\ncase when a.alert_type=10 then CONCAT(\'[温度超标预警]您的订单：\',a.order_no,\'，运输车辆：\',a.car_no,\'，当前温度：\',b.value,\'℃，即将超出商品温度要求上下限，请及时处理！\')\r\nelse CONCAT(\'[温度超标报警]您的订单：\',a.order_no,\'，运输车辆：\',a.car_no,\'，当前温度：\',b.value,\'℃，已超出商品温度要求上下限，请及时处理！\')\r\nend exception_content,\r\na.alert_time exception_time,\r\nnull exception_address,\r\nnull longitude,\r\nnull latitude,\r\nnull exception_number,\r\nnull exception_quantity,\r\nnull exception_reason,\r\nnull exception_remark,\r\nnull exception_file_num,\r\nnull register_person,\r\nnull register_time,\r\nnull source_channel,\r\nnull responsible_party,\r\nnull contact_tel,\r\nnull expect_return_time,\r\n0 rec_ver,\r\n0 rec_status,\r\n\'定时器\' creator,\r\n\'定时器\' create_name,\r\na.create_time,\r\na.modifier,\r\na.modify_name,\r\na.modify_time,\r\na.tenant_id,\r\na.department_id,\r\n0 handle_flag\r\nfrom mon_alert_order a\r\ninner join \r\n(SELECT DISTINCT\r\n	a.alert_no,\r\n	a.`value`\r\nFROM\r\n	mon_alert_detail a\r\nINNER JOIN (\r\n	SELECT\r\n		alert_no,\r\n		max(collect_time) collect_time\r\n	FROM\r\n		mon_alert_detail\r\n	GROUP BY\r\n		alert_no\r\n) b ON a.alert_no = b.alert_no\r\nAND a.collect_time = b.collect_time) b on a.alert_no =b.alert_no\r\ninner join et_waybill_info c on a.owb_way_bill_no = c.waybill_no\r\nwhere a.alert_type in(10,20) and a.alert_rule_code=\'TEMPERATURE_EXCEEDED_ALARM\'\r\nAND c.consigner_id = tenant_id_replace\r\n', '2018-11-08 17:13:02', 'Y', null, null, null, '0', '0', 'admin', 'sys', '2018-09-11 16:52:09', '', '', '2018-09-10 20:23:04');
INSERT INTO `jlt_job_detail` VALUES ('3', '1052596984302551041', null, '1', 'R', 'DB', 'saas', 'et_waybill_exception_detail', null, 'N', 'N', 'select carrier_id from cd_carrier_config where bind_type=2 and tenant_id =  tenant_id_replace', null, '', 'SELECT\r\n			a.*\r\n		FROM\r\n			et_waybill_exception_detail a\r\n			INNER JOIN et_waybill_exception b on a.exception_no = b.exception_no\r\n			inner join et_waybill_info c on b.waybill_no=c.waybill_no\r\n		where c.consigner_id = tenant_id_replace', '2018-11-08 17:13:02', 'Y', null, null, null, '0', '0', 'admin', 'sys', '2018-09-11 16:52:09', '', '', '2018-09-10 20:23:04');
INSERT INTO `jlt_job_detail` VALUES ('4', '1052596984302551041', null, '1', 'R', 'DB', 'saas', 'et_waybill_exception_handle', null, 'N', 'N', 'select carrier_id from cd_carrier_config where bind_type=2 and tenant_id =  tenant_id_replace', null, '', 'SELECT\r\n			a.*\r\n		FROM\r\n			et_waybill_exception_handle a\r\n			INNER JOIN et_waybill_exception b on a.exception_no = b.exception_no\r\n			inner join et_waybill_info c on b.waybill_no=c.waybill_no\r\n		where c.consigner_id = tenant_id_replace', '2018-11-08 17:13:02', 'Y', null, null, null, '0', '0', 'admin', 'sys', '2018-09-11 16:52:09', '', '', '2018-09-10 20:23:04');
INSERT INTO `jlt_job_detail` VALUES ('5', '1052596984302551041', null, '1', 'R', 'DB', 'saas', 'et_waybill_info', null, 'N', 'N', 'select carrier_id from cd_carrier_config where bind_type=2 and tenant_id =  tenant_id_replace', null, '', 'SELECT\r\na.id,\r\na.waybill_no,\r\na.ex_waybill_no,\r\na.elo_no,\r\na.consigner_waybill_no,\r\na.top_elo_no,\r\nif(a.waybill_status<=30,30,a.waybill_status) waybill_status,\r\na.bidding_status,\r\na.consigner_id,\r\na.consigner_code,\r\na.consigner_name,\r\na.company_id,\r\na.company_code,\r\na.company_name,\r\na.transport_type,\r\na.transport_mode,\r\na.vehicle_requirement,\r\na.order_time,\r\na.required_delivery_time,\r\na.required_arrival_time,\r\na.transit_time,\r\na.logistical_order_type,\r\na.pickup_type,\r\na.distribution_type,\r\na.customer_order_type,\r\na.business_type_code,\r\na.business_type_name,\r\na.double_transport,\r\na.shipper_id,\r\na.shipper_name,\r\na.shipper_contacts,\r\na.shipper_contact_phone,\r\na.shipper_contact_tel,\r\na.origin_province_id,\r\na.origin_province_name,\r\na.origin_city_id,\r\na.origin_city_name,\r\na.origin_area_id,\r\na.origin_area_name,\r\na.origin_detail_address,\r\na.origin_address_level,\r\na.consignee_id,\r\na.consignee_name,\r\na.consignee_contacts,\r\na.consignee_contact_phone,\r\na.consignee_contact_tel,\r\na.destination_province_id,\r\na.destination_province_name,\r\na.destination_city_id,\r\na.destination_city_name,\r\na.destination_area_id,\r\na.destination_area_name,\r\na.destination_detail_address,\r\na.destination_address_level,\r\na.collection_delivery_amount,\r\na.total_number,\r\na.total_detail_count,\r\na.total_quantity,\r\na.total_weight,\r\na.total_volume,\r\na.total_amount,\r\na.dispatch_no,\r\na.ex_dispatch_no,\r\na.vehicle_number,\r\na.vehicle_type,\r\na.main_driver_name,\r\na.main_driver_phone,\r\na.deputy_driver_name,\r\na.deputy_driver_phone,\r\na.has_splited,\r\na.split_type,\r\na.has_cd,\r\na.has_cl,\r\na.parent_waybill_no,\r\na.parent_ex_waybill_no,\r\na.waybill_group_no,\r\na.origin_waybill_no,\r\na.node_rule_id,\r\na.node_rule_name,\r\na.waybill_exception,\r\na.has_app,\r\na.has_gps,\r\na.has_temperature,\r\na.has_dampness,\r\na.has_exception,\r\na.has_confirm,\r\na.has_evaluate,\r\na.has_complaint,\r\na.has_receipt,\r\na.has_issued,\r\na.has_temperature_control,\r\na.has_humidity_control,\r\na.data_source,\r\na.source_system,\r\na.remark,\r\na.refuse_reason,\r\na.rec_ver,\r\na.rec_status,\r\na.creator,\r\na.create_name,\r\na.create_time,\r\na.modifier,\r\na.modify_name,\r\na.modify_time,\r\na.tenant_id,\r\na.department_id,\r\nb.cust_elo_no\r\nFROM\r\n	et_waybill_info a\r\n	inner join \r\nssm_eo_logistics_order b on a.elo_no=b.elo_no\r\nwhere a.consigner_id = tenant_id_replace', '2018-11-08 17:13:02', 'Y', null, 'and dispatch_no !=\'\' and dispatch_no is not null', null, '0', '0', 'admin', 'sys', '2018-09-11 16:52:09', '', '', '2018-09-10 20:23:04');
INSERT INTO `jlt_job_detail` VALUES ('6', '1052596984302551041', null, '1', 'R', 'DB', 'saas', 'et_waybill_info_ext', null, 'N', 'N', 'select carrier_id from cd_carrier_config where bind_type=2 and tenant_id =  tenant_id_replace', null, null, 'SELECT\r\n	a.*, c.create_time act_receipt_time\r\nFROM\r\n	et_waybill_info_ext a\r\ninner join et_waybill_info b on a.waybill_no=b.waybill_no and a.tenant_id = b.tenant_id\r\nLEFT JOIN (\r\n	SELECT\r\n		tenant_id,\r\n		business_pm_code,\r\n		min(create_time) create_time\r\n	FROM\r\n		et_file_ref\r\n	WHERE\r\n		business_type = 50\r\n	GROUP BY\r\n		tenant_id,\r\n		business_pm_code\r\n) c ON a.waybill_no = c.business_pm_code\r\nAND a.tenant_id = c.tenant_id\r\nwhere b.consigner_id = tenant_id_replace', '2018-11-08 17:13:02', 'Y', null, null, null, '0', '0', 'admin', 'sys', '2018-09-11 16:52:09', '', '', '2018-09-10 20:23:04');
INSERT INTO `jlt_job_detail` VALUES ('7', '1052596984302551041', null, '1', 'R', 'DB', 'saas', 'et_waybill_item', null, 'N', 'N', 'select carrier_id from cd_carrier_config where bind_type=2 and tenant_id =  tenant_id_replace', null, '', 'SELECT\r\n	 a.*, c.ws_manufacturer\r\nFROM\r\n	et_waybill_item a\r\ninner join et_waybill_info b on a.waybill_no=b.waybill_no\r\nLEFT JOIN mdm_sku c ON a.sku_no = c.ws_sku_code\r\nAND a.tenant_id = c.tenant_id and 	c.rec_status = 0\r\nwhere b.consigner_id = tenant_id_replace', '2018-11-08 17:13:02', 'Y', null, '', null, '0', '0', 'admin', 'sys', '2018-09-11 16:52:09', '', '', '2018-09-10 20:23:04');
INSERT INTO `jlt_job_detail` VALUES ('8', '1052596984302551041', null, '1', 'R', 'DB', 'saas', 'ssm_eo_logistics_order', null, 'N', 'N', 'select carrier_id from cd_carrier_config where bind_type=2 and tenant_id =  tenant_id_replace', '', '', 'SELECT\r\n	 a.elo_id id,a.elo_no,a.cust_elo_no,a.elo_status,a.tenant_id,a.department_id,a.create_time,\r\n			a.modify_time\r\nFROM\r\n	ssm_eo_logistics_order a', '2018-11-08 17:13:02', 'Y', null, 'and elo_status=60', null, '0', '0', 'admin', 'sys', '2018-09-11 16:52:09', '', '', '2018-09-10 20:23:04');
INSERT INTO `jlt_job_detail` VALUES ('9', '1052596984302551041', null, '1', 'R', 'DB', 'saas', 'gy_thermometer_history', null, 'N', 'N', 'select carrier_id from cd_carrier_config where bind_type=2 and tenant_id =  tenant_id_replace', null, '', '		SELECT\r\n			b.dispatch_no,\r\n			b.ex_dispatch_no,\r\n			b.waybill_no,\r\n			b.company_id,\r\n			b.company_name,\r\n			b.vehicle_number,\r\n			b.main_driver_name,\r\n			b.main_driver_phone,\r\n			a.temperature_receipt_time,\r\n			substring_index(\r\n				substring_index(\r\n					replace(a.temperature_all_no,\'，\',\',\'),\r\n					\',\',\r\n					b.Time_zone_id\r\n				),\r\n				\',\' ,- 1\r\n			) thermometer_no,\r\n			a.create_time,\r\n			a.modify_time,\r\n			a.tenant_id\r\n		FROM\r\n			et_waybill_info_ext a\r\n		INNER JOIN et_waybill_info b ON a.waybill_no = b.waybill_no\r\n		JOIN mysql.time_zone b ON b.Time_zone_id <= (\r\n			length(replace(a.temperature_all_no,\'，\',\',\')) - length(\r\n				REPLACE (\r\n					replace(a.temperature_all_no,\'，\',\',\'),\r\n					\',\',\r\n					\'\'\r\n				)\r\n			) + 1\r\n		)\r\nwhere b.consigner_id = tenant_id_replace', '2018-11-08 17:13:02', 'Y', null, null, null, '0', '0', 'admin', 'sys', '2018-09-11 16:52:09', '', '', '2018-09-10 20:23:04');
INSERT INTO `jlt_job_detail` VALUES ('10', '1052596984302551041', null, '1', 'R', 'REDIS', 'saas', 'et_waybill_mileage', 'waybill:mileage:tenant_id_replace', 'N', 'N', 'select carrier_id from cd_carrier_config where bind_type=2 and tenant_id =  tenant_id_replace', '', '', '', '2018-11-08 17:13:02', 'Y', null, '', null, '0', '0', 'admin', 'sys', '2018-09-11 16:52:09', '', '', '2018-09-10 20:23:04');
INSERT INTO `jlt_job_detail` VALUES ('11', '1052596984302551041', null, '1', 'W', 'DB', 'saas', 'mon_alert_rule', null, 'N', 'N', null, 'id,pm_code', '', null, '2018-11-07 21:31:01', 'Y', null, null, null, '0', '0', 'admin', 'sys', '2018-09-11 16:52:09', '', '', '2018-09-10 20:23:04');
INSERT INTO `jlt_job_detail` VALUES ('12', '1052596984302551041', null, '1', 'W', 'DB', 'saas', 'mon_alert_rule_notify', null, 'N', 'N', '', 'id,pm_code', '', null, null, null, null, null, null, '0', '0', 'admin', 'sys', '2018-09-11 16:52:09', '', '', '2018-09-10 20:23:04');
INSERT INTO `jlt_job_detail` VALUES ('13', '1052596984302551041', null, '1', 'R', 'EXT', 'pms', 'jc_file', '', 'N', 'N', '', '', '', '', '2018-11-08 17:13:02', 'Y', null, '', null, '0', '0', 'admin', 'sys', '2018-09-11 16:52:09', '', '', '2018-09-10 20:23:04');
INSERT INTO `jlt_job_detail` VALUES ('14', '1052596984302551041', null, '1', 'R', 'DB', 'saas', 'et_file_ref', '', 'N', 'N', 'select carrier_id from cd_carrier_config where bind_type=2 and tenant_id =  tenant_id_replace', 'id', '', '	SELECT\r\n			a.*\r\n		FROM\r\n			et_file_ref a\r\n		INNER JOIN et_waybill_info b ON a.business_pm_code = b.waybill_no\r\n		WHERE\r\n		b.consigner_id = tenant_id_replace', '2018-11-08 17:13:02', 'Y', null, '', null, '0', '0', 'admin', 'sys', '2018-09-11 16:52:09', '', '', '2018-09-10 20:23:04');
